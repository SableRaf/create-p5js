# Simplify TypeScript Definitions Strategy

## Overview
Remove complex version matching and user prompts for TypeScript definitions. Use a simple, deterministic approach based on p5.js major version.

## Current Problem
The `resolveTypesVersion()` function is overly complex:
- Fetches and validates all available @types/p5 versions
- Uses distance-based matching algorithms
- Prompts users when exact matches aren't found
- Validates versions with HEAD requests

## Simpler Approach

### For p5.js 1.x
**Don't download types from CDN at all.**

Instead:
- Copy a minimal `global.d.ts` file from `types/default/v1/global.d.ts` (already exists in repo)
- This file tells VS Code to auto-acquire from `@types/p5` package
- No version matching needed
- No network requests needed
- No user prompts needed

### For p5.js 2.x
**Download bundled types from p5.js package with simple fallback.**

Rules:
- Try to download from `https://cdn.jsdelivr.net/npm/p5@{version}/types/global.d.ts` and `p5.d.ts`
- If version is 2.0.0, 2.0.0-* (pre-releases), or 2.0.1 (no bundled types), use 2.0.2 instead
- If download fails (404 or other error), show error and exit
- No validation, no prompts, no complex matching

## Implementation Plan

### 1. Remove complex functions from version.js
**Delete these functions:**
- `fetchTypesVersions()` - no longer needed
- `findClosestVersion()` - no longer needed
- `findExactMinorMatch()` - no longer needed
- `flattenVersion()` - no longer needed
- `filterAvailableTypesVersions()` - no longer needed
- `filterVersionsWithBundledTypes()` - no longer needed
- `resolveTypesVersion()` - will be replaced with simpler logic

### 2. Simplify downloadTypeDefinitions()
**New logic:**
```javascript
export async function downloadTypeDefinitions(p5Version, targetDir, spinner, template) {
  const strategy = getTypesStrategy(p5Version);

  if (strategy.useTypesPackage) {
    // p5.js 1.x: Copy minimal global.d.ts from repo
    // Just use fs.copyFile from types/default/v1/global.d.ts
    return '1.7.7'; // Fixed version for reference only
  } else {
    // p5.js 2.x: Download bundled types with simple fallback
    let typesVersion = p5Version;

    // Hardcoded fallback for 2.0.0, 2.0.0-* (pre-releases), and 2.0.1
    if (p5Version === '2.0.0' || p5Version === '2.0.1' || p5Version.startsWith('2.0.0-')) {
      typesVersion = '2.0.2';
    }

    // Download from p5 package
    const files = [
      { name: 'global.d.ts', url: `https://cdn.jsdelivr.net/npm/p5@${typesVersion}/types/global.d.ts` },
      { name: 'p5.d.ts', url: `https://cdn.jsdelivr.net/npm/p5@${typesVersion}/types/p5.d.ts` }
    ];

    // Download files (existing logic)
    return typesVersion;
  }
}
```

### 3. Update callers
**Files to update:**
- `src/operations/scaffold.js` - remove `resolveTypesVersion()` call
- `src/operations/update.js` - remove `resolveTypesVersion()` call

**Change from:**
```javascript
const typesVersion = await resolveTypesVersion(version, spinner, isInteractive);
await downloadTypeDefinitions(version, typesVersion, typesDir, spinner, template);
```

**Change to:**
```javascript
const typesVersion = await downloadTypeDefinitions(version, typesDir, spinner, template);
```

### 4. Remove user prompts
**Delete from src/ui/prompts.js:**
- `promptTypesVersion()` function

**Delete from locales/en/prompts.json:**
- `prompt.types.*` keys

### 5. Update i18n messages
**Remove spinner messages:**
- `spinner.lookingUpTypes`
- `spinner.validatingTypes`

**Keep spinner messages:**
- `spinner.downloadingTypes`
- `spinner.downloadedTypes`
- `spinner.failedTypes`

**Remove info messages:**
- `info.autoSelectedTypes`

## Benefits

1. **Simpler codebase**: Remove ~200 lines of complex matching logic
2. **Faster execution**: No validation HEAD requests, no fetching @types/p5 versions
3. **Better UX**: No confusing prompts about types versions
4. **More reliable**: No network dependency for 1.x types
5. **Easier to maintain**: Clear, simple rules instead of complex algorithms

## Tradeoffs

- **p5.js 1.x users get outdated types** (1.7.7 vs current 1.11.x)
  - But this is already documented in README as acceptable
  - README suggests using 2.x for better types anyway
- **p5.js 2.x users might get slightly wrong types** if future versions break bundled types
  - But this is unlikely given 2.x has official bundled types
  - Can add more hardcoded fallbacks if needed

## Testing Checklist

- [ ] p5.js 1.9.0 → uses local global.d.ts, no download
- [ ] p5.js 2.0.0 (or pre-releases) → downloads types from 2.0.2
- [ ] p5.js 2.0.1 → downloads types from 2.0.2
- [ ] p5.js 2.0.2+ → downloads types from exact version
- [ ] No user prompts appear for types version
- [ ] Faster execution (no validation requests)
